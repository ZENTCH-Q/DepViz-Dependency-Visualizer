:root {
  --bg: #0e1116;
  --fg: #e6e6e6;
  --muted: #8b8b8b;
  --card: #1b2130;
  --module-bg: #141922;
  --accent: #62a0ea;
  --outline: #8a919a;
  --grid1: rgba(255,255,255,0.12);
  --grid2: rgba(255,255,255,0.08);
  --hover: #2a3347;
  --selected: #1fb6ff;
  --shadow: rgba(0,0,0,0.5);
  --hi-white: #ffffff;
  --hi-cyan: #00ffff;
}
html[data-theme="light"] {
  --module-bg: #e9edf4;
  --bg: #fafafa;
  --fg: #111;
  --muted: #666;
  --card: #ffffff;
  --accent: #1a73e8;
  --outline: #747a80;      /* darker for contrast */
  --grid1: rgba(0,0,0,0.12);
  --grid2: rgba(0,0,0,0.08);
  --hover: #eef3ff;
  --selected: #0ea5e9;
  --shadow: rgba(0,0,0,0.15);
  --hi-white: #000;
  --hi-cyan: #06b6d4;
}
html, body { height: 100%; }
body {
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}

/* toolbar */
#toolbar {
  position: absolute; top: 8px; left: 8px;
  display: flex; align-items: center; gap: 8px;
  background: var(--card);
  padding: 6px 10px; border-radius: 8px;
  box-shadow: 0 4px 16px var(--shadow);
  z-index: 10;
}

#help {
  position: absolute;
  top: 48px;           /* sit just below the toolbar */
  left: 8px;
  z-index: 20;         /* above the toolbar (z-index:10) */
}
#help .hcard {
  background: var(--card);
  border: 1px solid var(--outline);
  border-radius: 8px;
  padding: 8px 10px;
  box-shadow: 0 6px 24px var(--shadow);
}
#themeToggle { cursor: pointer; }
#toolbar button {
  background: var(--hover);
  color: var(--fg);
  border: 1px solid var(--outline);
  border-radius: 6px;
  padding: 4px 8px;
  cursor: pointer;
}
#toolbar button:hover { filter: brightness(1.05); }

#canvasWrapper {
  position: absolute; inset: 0;
  /* tunables */
  --grid-a: 0.06;   /* primary dot alpha (dark) */
  --grid-b: 0.03;   /* secondary dot alpha (dark) */
  --grid-s1: 28px;  /* fine grid size */
  --grid-s2: 140px; /* coarse grid size */
  --vignette: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.16), transparent 65%);
  /* calm, layered background */
  background:
    var(--vignette),
    radial-gradient(rgba(255,255,255,var(--grid-a)) 1.2px, transparent 1.2px),
    radial-gradient(rgba(255,255,255,var(--grid-b)) 1.2px, transparent 1.2px);
  background-size: 100% 100%, var(--grid-s1) var(--grid-s1), var(--grid-s2) var(--grid-s2);
  background-position: 0 0, 0 0, 0 0;
  overflow: hidden;
}
#canvas { width: 100%; height: 100%; }
svg, #canvasWrapper, #canvas {
  -webkit-user-select: none;
  user-select: none;
}
/* Light theme tweaks for contrast */
html[data-theme="light"] #canvasWrapper {
  --vignette: radial-gradient(circle at 50% 40%, rgba(0,0,0,0.06), transparent 65%);
  --grid-a: 0.08;
  --grid-b: 0.04;
}

/* Optional: ultra-low noise to reduce banding */
#canvasWrapper::after {
  content: "";
  position: absolute; inset: 0;
  pointer-events: none;
  opacity: .035;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAFklEQVQYV2NkYGD4z0ABYBwTA0YAAHRfBv0F6mZ0AAAAAElFTkSuQmCC');
  background-size: 8px 8px;
}
text, .module-title, .module-badge, .label, .badge {
  pointer-events: none;
  -webkit-user-select: none;
  user-select: none;
}

/* Modules */
.module {
  fill: var(--module-bg);
  stroke: var(--outline);
  stroke-width: 1.6;
  rx: 10; ry: 10;
  cursor: grab;
}
.module.dragging { cursor: grabbing; }
g.module-group.hover rect.module { stroke: var(--hi-white); }
g.module-group.selected rect.module { stroke: var(--hi-white); stroke-width: 2.6; }
.module-title { font-size: 12px; fill: var(--fg); font-weight: 600; }
.module-badge { font-size: 10px; fill: var(--muted); }
.module-toggle { cursor: pointer; fill: var(--muted); }
.module-toggle:hover { fill: var(--fg); }

/* Classes (nested containers) */
.class {
  fill: var(--module-bg);
  stroke: var(--outline);
  stroke-width: 1.4;
  rx: 8; ry: 8;
  cursor: grab;
}
.class.dragging { cursor: grabbing; }

/* Functions */
.func {
  fill: var(--card);
  stroke: var(--outline);
  stroke-width: 1.4;
  rx: 8; ry: 8;
  cursor: grab;
}
.func.dragging { cursor: grabbing; }
g.func-group.hover rect.func { stroke-width: 1.8; stroke: var(--hi-white); }
g.func-group.selected rect.func { stroke-width: 2.6; stroke: var(--hi-white); }
.label { font-size: 12px; fill: var(--fg); pointer-events: none; }
.badge { font-size: 10px; fill: var(--muted); }

/* Edges */
.edge { fill: none; stroke-width: 2.2; pointer-events: stroke; }
.edge.import { stroke-dasharray: 8 6; stroke-linecap: butt; }
.edge.call   { stroke-dasharray: none; stroke-linecap: round; }
.edge.unresolved { opacity: .35; stroke-dasharray: 3 3; }

.edge.hover { stroke-width: 3.2; }
.edge.selected { stroke-width: 3.2; stroke: var(--hi-white); }
.edge.hidden { opacity: 0; pointer-events: none; }
.edge-arrow.transparent { opacity: 0; pointer-events: none; }

.edge-arrow { fill: currentColor; stroke: none; pointer-events: none; }
.edge-arrow.import { color: #a8b1ff; }
.edge-arrow.call   { color: #86efac; }

.node-related rect { stroke: var(--hi-cyan) !important; stroke-width: 2.4 !important; }
.node-hidden { display: none !important; }
.ghost rect.module { opacity: 0.6; }

.transparent, .node-transparent { opacity: 0 !important; pointer-events: none !important; }

/* Search highlight */
.search-mark { fill: rgba(255, 255, 0, 0.35); rx: 3; ry: 3; pointer-events: none; }

/* Legend */
#legend {
  position: absolute; right: 8px; top: 8px; z-index: 9;
  background: var(--card); padding: 6px 10px; border-radius: 8px;
  box-shadow: 0 4px 16px var(--shadow);
  display: flex; gap: 12px; align-items: center;
  user-select: none;
}
.legend-item { display:flex; align-items:center; gap:6px; cursor:pointer; }
.legend-item.off { opacity: 0.35; }
.legend-svg { width: 38px; height: 10px; display:inline-block; }

/* Type colors */
.edge.import, .legend-path.import { stroke: #a8b1ff; }
.edge.call,   .legend-path.call   { stroke: #86efac; }

/* Snippet panel placeholder (unchanged) */
#snippet { display:none; }

/* Context menu */
.context-menu {
  position: fixed;
  display: none;
  background: var(--card);
  border: 1px solid var(--outline);
  border-radius: 6px;
  box-shadow: 0 6px 24px var(--shadow);
  z-index: 100;
  padding: 4px;
  min-width: 120px;
}
.context-menu button {
  display: block;
  width: 100%;
  padding: 6px 10px;
  background: transparent;
  border: 0;
  color: var(--fg);
  text-align: left;
  cursor: pointer;
}
.context-menu button:hover { background: var(--hover); }

/* Cascaded submenu */
.context-sub { position: fixed; }

/* Search popup */
#searchPopup {
  position: fixed;
  left: 50%; bottom: 20px; transform: translateX(-50%);
  background: var(--card);
  border: 1px solid var(--outline);
  border-radius: 8px;
  padding: 8px 10px;
  box-shadow: 0 8px 28px var(--shadow);
  z-index: 120;
  display: none; /* will be set to flex when open */
  align-items: center;
  gap: 10px;
}
#searchPopup input {
  width: 360px; max-width: 60vw;
  background: transparent; border: 0; outline: none; color: var(--fg);
  font-size: 14px;
}
#searchControls { margin-top: 0; display: flex; gap: 8px; align-items: center; }
#searchControls button { background: var(--hover); color: var(--fg); border: 1px solid var(--outline); border-radius: 4px; padding: 2px 8px; cursor: pointer; }
#searchControls #searchCount { color: var(--muted); min-width: 48px; text-align: center; }
